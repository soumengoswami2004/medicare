<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Appointment - MediCare</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f8f9fa;
        }
        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
        }
        .card {
            border: none;
            border-radius: 15px;
        }
        .card-header {
            border-radius: 15px 15px 0 0 !important;
            border: none;
        }
        .form-control, .form-select {
            border-radius: 8px;
            border: 2px solid #e9ecef;
            padding: 12px 15px;
        }
        .form-control:focus, .form-select:focus {
            border-color: #20f7ef;
            box-shadow: 0 0 0 0.2rem rgba(32, 247, 239, 0.25);
        }
        .btn-success {
            background-color: #28a745;
            border-color: #28a745;
            border-radius: 8px;
            padding: 12px 30px;
            font-weight: 600;
        }
        .btn-success:hover {
            background-color: #218838;
            border-color: #1e7e34;
        }
        .medical-icon {
            width: 24px;
            height: 24px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="/">
                <svg class="medical-icon" fill="#0d6efd" viewBox="0 0 24 24">
                    <path d="M19 8l-4 4h3c0 3.31-2.69 6-6 6-1.01 0-1.97-.25-2.8-.7l-1.46 1.46C8.97 19.54 10.43 20 12 20c4.42 0 8-3.58 8-8h3l-4-4zM6 12c0-3.31 2.69-6 6-6 1.01 0 1.97.25 2.8.7l1.46-1.46C15.03 4.46 13.57 4 12 4c-4.42 0-8 3.58-8 8H1l4 4 4-4H6z"/>
                </svg>
                MediCare
            </a>
            
            <div class="navbar-nav ms-auto">
                <a class="nav-link me-3" href="/">Home</a>
                <button class="btn btn-outline-danger btn-sm" id="logoutBtn">Logout</button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-5">
        <div class="card shadow">
            <div class="card-header text-dark" style="background-color: #20f7ef;">
                <h4 class="mb-0">Book Appointment with Dr. <%= doctor.name %></h4>
            </div>

            <div class="card-body">
                <div class="row">
                    <!-- Left side image -->
                    <div class="col-md-5 text-center mb-3">
                        <img src="https://img.freepik.com/free-vector/doctor-clinic-illustration_1308-27202.jpg"
                             class="img-fluid h-100 w-100 object-fit-cover rounded-start"
                             alt="Clinic"
                             style="min-height: 100%; max-height: 90%; object-fit: cover;">
                    </div>

                    <!-- Right side form -->
                    <div class="col-md-7">
                        <form action="/doctors/<%= doctor._id %>/book" method="POST">
                            <div class="mb-3">
                                <label class="form-label">Specialization</label>
                                <input type="text" class="form-control" value="<%= doctor.specialization %>" disabled>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Clinic Name</label>
                                <input type="text" class="form-control" value="<%= doctor.clinicName %>" disabled>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Clinic Address</label>
                                <textarea class="form-control" rows="2" disabled><%= doctor.clinicAddress %></textarea>
                            </div>

                            <div class="mb-3">
                                <label for="availableDate" class="form-label">Choose Date</label>
                                <input type="text" id="availableDate" name="date" class="form-control" placeholder="Select a date" required>
                            </div>

                            <div class="mb-3">
                                <label for="slot" class="form-label">Available Time Slots</label>
                                <select name="slot" id="slot" class="form-select" required>
                                    <option value="">Select a time slot</option>
                                    <% doctor.availableSlots.forEach(slot => { %>
                                        <option value="<%= slot %>"><%= slot %></option>
                                    <% }) %>
                                </select>
                            </div>

                            <div class="d-grid">
                                <button type="submit" class="btn btn-success">Confirm Booking</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', function() {
            if (confirm('Are you sure you want to logout?')) {
                alert('You have been logged out successfully!');
                window.location.href = '/';
            }
        });

        // Flatpickr initialization - using your exact setup
        let rawDates = <%- JSON.stringify(doctor.availableDates) %>;

        // Check if it contains one long string with commas
        if (rawDates.length === 1 && rawDates[0].includes(",")) {
            rawDates = rawDates[0].split(",").map(d => d.trim());
        }

        flatpickr("#availableDate", {
            dateFormat: "Y-m-d",
            enable: rawDates
        });

        // Form validation
        document.querySelector('form').addEventListener('submit', function(e) {
            const selectedDate = document.getElementById('availableDate').value;
            const selectedSlot = document.getElementById('slot').value;

            if (!selectedDate || !selectedSlot) {
                e.preventDefault();
                alert('Please select both date and time slot before booking.');
                return;
            }

            // Show confirmation
            const confirmMessage = `Confirm your appointment:\n\nDoctor: Dr. <%= doctor.name %>\nDate: ${selectedDate}\nTime: ${selectedSlot}\n\nProceed with booking?`;
            
            if (!confirm(confirmMessage)) {
                e.preventDefault();
                return;
            }
        });

        // Loading state on form submission
        document.querySelector('form').addEventListener('submit', function() {
            const submitBtn = document.querySelector('button[type="submit"]');
            submitBtn.innerHTML = 'Processing...';
            submitBtn.disabled = true;
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96b7d7a8c4caf655',t:'MTc1NDU4MDkxMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
