<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediCare</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .card-hover {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .flatpickr-calendar {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
        }

        .flatpickr-day.selected {
            background: #3B82F6;
            border-color: #3B82F6;
        }

        .form-focus:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            border-color: #3B82F6;
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

</head>

<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <svg class="h-8 w-8 text-blue-600 mr-2" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M19 8l-4 4h3c0 3.31-2.69 6-6 6-1.01 0-1.97-.25-2.8-.7l-1.46 1.46C8.97 19.54 10.43 20 12 20c4.42 0 8-3.58 8-8h3l-4-4zM6 12c0-3.31 2.69-6 6-6 1.01 0 1.97.25 2.8.7l1.46-1.46C15.03 4.46 13.57 4 12 4c-4.42 0-8 3.58-8 8H1l4 4 4-4H6z" />
                        </svg>
                        <span class="text-xl font-bold text-gray-800">MediCare</span>
                    </div>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="/"
                            class="text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium">Home</a>
                        <a href="#doctors"
                            class="text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium">Doctors</a>
                        <a href="#services"
                            class="text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium">Services</a>
                        <a href="#"
                            class="text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium">About</a>
                        <a href="#"
                            class="text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium">Contact</a>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- Login/Logout buttons (shown when not logged in) -->
                    <% if (!currentUser) { %>
                        <!-- Show login and signup if not logged in -->
                        <div id="authButtons" class="flex items-center space-x-4">
                            <a href="/auth/login">
                                <button
                                    class="text-gray-700 hover:text-blue-600 px-4 py-2 text-sm font-medium transition duration-200">
                                    Log In
                                </button>
                            </a>
                            <a href="/auth/signup">
                                <button
                                    class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition duration-200">
                                    Sign Up
                                </button>
                            </a>
                        </div>
                        <% } else { %>
                            <!-- Show profile section if logged in -->
                            <div id="userProfile" class="flex items-center space-x-4">
                                <div class="relative">
                                    <button id="profileBtn"
                                        class="flex items-center space-x-2 text-gray-700 hover:text-blue-600 transition duration-200">
                                        <div
                                            class="w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white text-sm font-bold">
                                            <span id="userInitials">
                                                <%= currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase() %></span>
        </div>
        <span id="userName" class="text-sm font-medium"><%= currentUser.name %></span>
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
      </button>
      <div id="profileDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-50">
        <div class="py-2">
          <a href="/dashboard" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition duration-200">
            📊 Dashboard
          </a>
          <a href="/auth/logout" >
           <button class="block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition duration-200">
  🚪 Log Out
  </button>
</a>

        </div>
      </div>
    </div>
  </div>
<% } %>
                </div>
            </div>
        </div>
    </nav>

    
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Header Section -->
        <div class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">Book Your Appointment</h1>
            <p class="text-lg text-gray-600">Schedule your consultation with our qualified healthcare professional</p>
        </div>

        <!-- Booking Card -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden card-hover max-w-6xl mx-auto">
            <!-- Header -->
            <div class="bg-gradient-to-r from-cyan-400 to-cyan-500 px-6 py-4">
                <h2 class="text-xl font-semibold text-white flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3a1 1 0 011-1h6a1 1 0 011 1v4h3a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9a2 2 0 012-2h3z"/>
                    </svg>
                    Book Appointment with Dr. <%= doctor.name %>
                </h2>
            </div>

            <div class="p-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Left Side - Doctor Info & Image -->
                    <div class="space-y-6">
                        <!-- Doctor Image -->
                        <div class="relative">
                            <img src="<%= doctor.photo %>"
                                 class="w-full h-64 object-cover rounded-xl shadow-lg"
                                 alt="Medical Clinic">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent rounded-xl"></div>
                        </div>

                        <!-- Doctor Details Card -->
                        <div class="bg-gray-50 rounded-xl p-6 space-y-4">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                                </svg>
                                Doctor Information
                            </h3>
                            
                            <div class="space-y-3">
                                <div class="flex items-start">
                                    <span class="text-sm font-medium text-gray-500 w-24">Name:</span>
                                    <span class="text-sm text-gray-900 font-medium">Dr. <%= doctor.name %></span>
                                </div>
                                
                                <div class="flex items-start">
                                    <span class="text-sm font-medium text-gray-500 w-24">Specialty:</span>
                                    <span class="text-sm text-blue-600 font-medium"><%= doctor.specialization %></span>
                                </div>
                                
                                <div class="flex items-start">
                                    <span class="text-sm font-medium text-gray-500 w-24">Experience:</span>
                                    <span class="text-sm text-gray-900"><%= doctor.experience || ' 10+' %> years
                                            </span>
                                        </div>

                                        <div class="flex items-start">
                                            <span class="text-sm font-medium text-gray-500 w-24">Rating:</span>
                                            <div class="flex items-center">
                                                <div class="flex text-yellow-400 text-sm mr-2">⭐⭐⭐⭐⭐</div>
                                                <span class="text-sm text-gray-600">
                                                    <%= doctor.rating || '4.9' %> (127 reviews)
                                                </span>
                                            </div>
                                        </div>

                                        <div class="flex items-start">
                                            <span class="text-sm font-medium text-gray-500 w-24">Fee:</span>
                                            <span class="text-sm font-semibold text-green-600">₹<%= doctor.fee || '500'
                                                    %></span>
                                        </div>
                                </div>
                            </div>

                            <!-- Clinic Information -->
                            <div class="bg-blue-50 rounded-xl p-6">
                                <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd"
                                            d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 2h12v8H4V6z"
                                            clip-rule="evenodd" />
                                    </svg>
                                    Clinic Details
                                </h3>

                                <div class="space-y-3">
                                    <div>
                                        <span class="text-sm font-medium text-gray-500">Clinic Name:</span>
                                        <p class="text-sm text-gray-900 mt-1">
                                            <%= doctor.clinicName %>
                                        </p>
                                    </div>

                                    <div>
                                        <span class="text-sm font-medium text-gray-500">Address:</span>
                                        <p class="text-sm text-gray-900 mt-1">
                                            <%= doctor.clinicAddress %>
                                        </p>
                                    </div>


                                </div>
                            </div>
                </div>

                <!-- Right Side - Booking Form -->
                <div class="space-y-6">
                    <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 7V3a1 1 0 011-1h6a1 1 0 011 1v4h3a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9a2 2 0 012-2h3z" />
                            </svg>
                            Schedule Your Appointment
                        </h3>

                        <form action="/bookings/<%= doctor._id %>/book" method="POST" class="space-y-6">
                            <!-- Hidden Inputs -->
                            <input type="hidden" name="doctorId" value="<%= doctor._id %>">
                            
                            
                            <!-- Appointment Details -->
                            <div class="space-y-4">
                                <h4 class="font-medium text-gray-900">Appointment Details</h4>

                                <div>
                                    <label for="availableDate"
                                        class="block text-sm font-medium text-gray-700 mb-2">Choose Date *</label>
                                    <input type="text" id="availableDate" name="date"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent form-focus transition duration-200"
                                        placeholder="Select a date" required readonly>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Available Time Slot
                                        *</label>
                                    <div class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100">
                                        <%= doctor.availableSlots[0] %>
                                    </div>
                                </div>



                            </div>

                            <!-- Consultation Fee -->
                            <div class="bg-white rounded-lg p-4 border border-gray-200">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-gray-700">Consultation Fee:</span>
                                    <span class="text-lg font-bold text-green-600">₹<%= doctor.fee || '500' %></span>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">Payment can be made at the clinic</p>
                            </div>

                            <!-- Submit Button -->
                            <button type="submit"
                                class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold py-4 px-6 rounded-lg transition duration-200 transform hover:scale-105 shadow-lg">
                                <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M5 13l4 4L19 7" />
                                </svg>
                                Confirm Booking
                            </button>
                        </form>
                    </div>

                    <!-- Important Notes -->
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <h4 class="font-medium text-yellow-800 mb-2 flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                    clip-rule="evenodd" />
                            </svg>
                            Important Notes
                        </h4>
                        <ul class="text-sm text-yellow-700 space-y-1">
                            <li>• Please arrive 15 minutes before your appointment</li>
                            <li>• Bring a valid ID and any previous medical records</li>
                            
                            <li>• Consultation fee is payable at the clinic</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        </div>
        </div>

        <!-- Footer -->
        <footer class="bg-gray-900 text-white py-12 mt-16">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                    <div>
                        <div class="flex items-center mb-4">
                            <svg class="h-8 w-8 text-blue-400 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M19 8l-4 4h3c0 3.31-2.69 6-6 6-1.01 0-1.97-.25-2.8-.7l-1.46 1.46C8.97 19.54 10.43 20 12 20c4.42 0 8-3.58 8-8h3l-4-4zM6 12c0-3.31 2.69-6 6-6 1.01 0 1.97.25 2.8.7l1.46-1.46C15.03 4.46 13.57 4 12 4c-4.42 0-8 3.58-8 8H1l4 4 4-4H6z" />
                            </svg>
                            <span class="text-xl font-bold">MediCare</span>
                        </div>
                        <p class="text-gray-400">Your trusted partner in healthcare, making quality medical services
                            accessible to everyone.</p>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold mb-4">Quick Links</h3>
                        <ul class="space-y-2">
                            <li><a href="/" class="text-gray-400 hover:text-white transition duration-200">Home</a></li>
                            <li><a href="/doctors"
                                    class="text-gray-400 hover:text-white transition duration-200">Doctors</a></li>
                            <li><a href="#" class="text-gray-400 hover:text-white transition duration-200">Services</a>
                            </li>
                            <li><a href="#" class="text-gray-400 hover:text-white transition duration-200">About Us</a>
                            </li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold mb-4">Services</h3>
                        <ul class="space-y-2">
                            <li><a href="#" class="text-gray-400 hover:text-white transition duration-200">General
                                    Medicine</a></li>
                            <li><a href="#"
                                    class="text-gray-400 hover:text-white transition duration-200">Cardiology</a></li>
                            <li><a href="#"
                                    class="text-gray-400 hover:text-white transition duration-200">Pediatrics</a></li>
                            <li><a href="#"
                                    class="text-gray-400 hover:text-white transition duration-200">Dermatology</a></li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold mb-4">Contact Info</h3>
                        <div class="space-y-2 text-gray-400">
                            <p>
  <i class="bi bi-telephone"></i> xxxxxxxx95
</p>
<p>
  <i class="bi bi-envelope"></i>
  <a href="mailto:goswamisoumen02@gmail.com">goswamisoumen02@gmail.com</a>
</p>
<p>
  <i class="bi bi-geo-alt"></i> Kolkata, West Bengal
</p>

                        </div>
                    </div>
                </div>
                <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
                    <p>&copy; 2024 MediCare. All rights reserved.</p>
                </div>
            </div>
        </footer>

        <!-- Scripts -->
        <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
        <script>
  document.addEventListener("DOMContentLoaded", function () {

    // Toggle dropdown when profile button is clicked
    document.getElementById("profileBtn")?.addEventListener("click", function (e) {
      e.stopPropagation();
      const dropdown = document.getElementById("profileDropdown");
      dropdown.classList.toggle("hidden");
    });

    // Close dropdown when clicking outside
    document.addEventListener("click", function () {
      document.getElementById("profileDropdown")?.classList.add("hidden");
    });

    // Date picker initialization with backend dates
    let rawDates = <%- JSON.stringify(doctor.availableDates) %>;
    if (rawDates.length === 1 && rawDates[0].includes(",")) {
      rawDates = rawDates[0].split(",").map(d => d.trim());
    }

    flatpickr("#availableDate", {
      dateFormat: "Y-m-d",
      enable: rawDates,
      minDate: "today",
      theme: "material_blue"
    });

    // Auto-format phone number (XXXXX XXXXX)
    document.getElementById('patientPhone')?.addEventListener('input', function (e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length > 10) value = value.substring(0, 10);
      if (value.length > 5) value = value.replace(/(\d{5})(\d{0,5})/, '$1 $2');
      e.target.value = value;
    });

    // Form validation and confirmation
    const form = document.querySelector('form');
    form?.addEventListener('submit', function (e) {
      const name = document.getElementById('patientName').value.trim();
      const age = document.getElementById('patientAge').value;
      const gender = document.getElementById('patientGender').value;
      const phone = document.getElementById('patientPhone').value.trim();
      const date = document.getElementById('availableDate').value;
      const slot = document.getElementById('slot')?.value || document.getElementById('slotText')?.innerText;

      if (!name || !age || !gender || !phone || !date || !slot) {
        e.preventDefault();
        alert('Please fill in all required fields.');
        return;
      }

      const phoneRegex = /^[\+]?[1-9][\d]{9,14}$/;
      if (!phoneRegex.test(phone.replace(/\s/g, ''))) {
        e.preventDefault();
        alert('Please enter a valid phone number.');
        return;
      }

      if (age < 1 || age > 120) {
        e.preventDefault();
        alert('Please enter a valid age between 1 and 120.');
        return;
      }

      const confirmMsg = `Confirm appointment:\n\nName: ${name}\nAge: ${age}\nGender: ${gender}\nPhone: ${phone}\nDate: ${date}\nTime: ${slot}\n\nProceed?`;
      if (!confirm(confirmMsg)) {
        e.preventDefault();
        return;
      }

      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.innerHTML = `
        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg> Processing Booking...
      `;
      submitBtn.disabled = true;
    });

  });
</script>



        <script>(function () { function c() { var b = a.contentDocument || a.contentWindow.document; if (b) { var d = b.createElement('script'); d.innerHTML = "window.__CF$cv$params={r:'96b84a2dc2f3f64b',t:'MTc1NDU4NTYwMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);"; b.getElementsByTagName('head')[0].appendChild(d) } } if (document.body) { var a = document.createElement('iframe'); a.height = 1; a.width = 1; a.style.position = 'absolute'; a.style.top = 0; a.style.left = 0; a.style.border = 'none'; a.style.visibility = 'hidden'; document.body.appendChild(a); if ('loading' !== document.readyState) c(); else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c); else { var e = document.onreadystatechange || function () { }; document.onreadystatechange = function (b) { e(b); 'loading' !== document.readyState && (document.onreadystatechange = e, c()) } } } })();</script>
</body>

</html>